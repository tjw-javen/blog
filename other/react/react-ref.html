<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React ref 原来是这样的 | tanjiawen</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog/icon.png">
    <meta name="description" content="Just do it">
    
    <link rel="preload" href="/blog/assets/css/0.styles.fb68c3ca.css" as="style"><link rel="preload" href="/blog/assets/js/app.a9945600.js" as="script"><link rel="preload" href="/blog/assets/js/2.3af135cd.js" as="script"><link rel="preload" href="/blog/assets/js/153.6de516b6.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.8284ffc7.js"><link rel="prefetch" href="/blog/assets/js/100.f43ee495.js"><link rel="prefetch" href="/blog/assets/js/101.af588b87.js"><link rel="prefetch" href="/blog/assets/js/102.fceaf7cd.js"><link rel="prefetch" href="/blog/assets/js/103.237512b5.js"><link rel="prefetch" href="/blog/assets/js/104.5b0b5556.js"><link rel="prefetch" href="/blog/assets/js/105.377afdf9.js"><link rel="prefetch" href="/blog/assets/js/106.6c8faab0.js"><link rel="prefetch" href="/blog/assets/js/107.f05b17b2.js"><link rel="prefetch" href="/blog/assets/js/108.24380ae4.js"><link rel="prefetch" href="/blog/assets/js/109.4fc3aa4f.js"><link rel="prefetch" href="/blog/assets/js/11.9e763810.js"><link rel="prefetch" href="/blog/assets/js/110.9872b4b9.js"><link rel="prefetch" href="/blog/assets/js/111.8be8fde4.js"><link rel="prefetch" href="/blog/assets/js/112.9f21b37f.js"><link rel="prefetch" href="/blog/assets/js/113.5d6d8b94.js"><link rel="prefetch" href="/blog/assets/js/114.ae32905e.js"><link rel="prefetch" href="/blog/assets/js/115.6c90fdfc.js"><link rel="prefetch" href="/blog/assets/js/116.4c181179.js"><link rel="prefetch" href="/blog/assets/js/117.b775cf93.js"><link rel="prefetch" href="/blog/assets/js/118.1cc72273.js"><link rel="prefetch" href="/blog/assets/js/119.e1c025d6.js"><link rel="prefetch" href="/blog/assets/js/12.06a3d36d.js"><link rel="prefetch" href="/blog/assets/js/120.4932db4b.js"><link rel="prefetch" href="/blog/assets/js/121.276f05eb.js"><link rel="prefetch" href="/blog/assets/js/122.26d84809.js"><link rel="prefetch" href="/blog/assets/js/123.a1dcb4d5.js"><link rel="prefetch" href="/blog/assets/js/124.bc51e9ad.js"><link rel="prefetch" href="/blog/assets/js/125.f1c600f6.js"><link rel="prefetch" href="/blog/assets/js/126.4a939469.js"><link rel="prefetch" href="/blog/assets/js/127.de1057e9.js"><link rel="prefetch" href="/blog/assets/js/128.47b26a21.js"><link rel="prefetch" href="/blog/assets/js/129.375e29fe.js"><link rel="prefetch" href="/blog/assets/js/13.5f19c836.js"><link rel="prefetch" href="/blog/assets/js/130.2f5f1157.js"><link rel="prefetch" href="/blog/assets/js/131.41c79642.js"><link rel="prefetch" href="/blog/assets/js/132.bf263adf.js"><link rel="prefetch" href="/blog/assets/js/133.e2199dcd.js"><link rel="prefetch" href="/blog/assets/js/134.a8b03f50.js"><link rel="prefetch" href="/blog/assets/js/135.6ec46987.js"><link rel="prefetch" href="/blog/assets/js/136.8b3fdace.js"><link rel="prefetch" href="/blog/assets/js/137.a427c5c6.js"><link rel="prefetch" href="/blog/assets/js/138.1cf3e855.js"><link rel="prefetch" href="/blog/assets/js/139.63e6b0c6.js"><link rel="prefetch" href="/blog/assets/js/14.51a8431a.js"><link rel="prefetch" href="/blog/assets/js/140.9615b46c.js"><link rel="prefetch" href="/blog/assets/js/141.230b60ba.js"><link rel="prefetch" href="/blog/assets/js/142.8eda03ee.js"><link rel="prefetch" href="/blog/assets/js/143.c4d976f1.js"><link rel="prefetch" href="/blog/assets/js/144.699fc7ec.js"><link rel="prefetch" href="/blog/assets/js/145.e3ab15da.js"><link rel="prefetch" href="/blog/assets/js/146.08905a96.js"><link rel="prefetch" href="/blog/assets/js/147.09ca7dfc.js"><link rel="prefetch" href="/blog/assets/js/148.45af3dc5.js"><link rel="prefetch" href="/blog/assets/js/149.c3b4d241.js"><link rel="prefetch" href="/blog/assets/js/15.72a92a5e.js"><link rel="prefetch" href="/blog/assets/js/150.6b86563f.js"><link rel="prefetch" href="/blog/assets/js/151.804e4177.js"><link rel="prefetch" href="/blog/assets/js/152.70cc135c.js"><link rel="prefetch" href="/blog/assets/js/154.c642c181.js"><link rel="prefetch" href="/blog/assets/js/155.b59c4d7f.js"><link rel="prefetch" href="/blog/assets/js/156.ee19c90e.js"><link rel="prefetch" href="/blog/assets/js/157.e249f132.js"><link rel="prefetch" href="/blog/assets/js/158.f49f881b.js"><link rel="prefetch" href="/blog/assets/js/159.ee57b260.js"><link rel="prefetch" href="/blog/assets/js/16.ef643ba6.js"><link rel="prefetch" href="/blog/assets/js/160.3f1f373b.js"><link rel="prefetch" href="/blog/assets/js/161.8f3bf814.js"><link rel="prefetch" href="/blog/assets/js/162.be1644a6.js"><link rel="prefetch" href="/blog/assets/js/163.54bfb0d9.js"><link rel="prefetch" href="/blog/assets/js/164.c7630457.js"><link rel="prefetch" href="/blog/assets/js/165.48921b01.js"><link rel="prefetch" href="/blog/assets/js/166.ff957762.js"><link rel="prefetch" href="/blog/assets/js/167.952152c7.js"><link rel="prefetch" href="/blog/assets/js/168.18858c2d.js"><link rel="prefetch" href="/blog/assets/js/169.cfa7b9d3.js"><link rel="prefetch" href="/blog/assets/js/17.a2ce8782.js"><link rel="prefetch" href="/blog/assets/js/170.2f675b22.js"><link rel="prefetch" href="/blog/assets/js/171.3a66756a.js"><link rel="prefetch" href="/blog/assets/js/172.842fd9e9.js"><link rel="prefetch" href="/blog/assets/js/173.5bba42f1.js"><link rel="prefetch" href="/blog/assets/js/174.b3b3ea12.js"><link rel="prefetch" href="/blog/assets/js/18.7f01d8ef.js"><link rel="prefetch" href="/blog/assets/js/19.e3513f33.js"><link rel="prefetch" href="/blog/assets/js/20.03616f12.js"><link rel="prefetch" href="/blog/assets/js/21.2298db57.js"><link rel="prefetch" href="/blog/assets/js/22.74c0e9e0.js"><link rel="prefetch" href="/blog/assets/js/23.f3fca169.js"><link rel="prefetch" href="/blog/assets/js/24.76042ebf.js"><link rel="prefetch" href="/blog/assets/js/25.565736de.js"><link rel="prefetch" href="/blog/assets/js/26.a780b1d1.js"><link rel="prefetch" href="/blog/assets/js/27.9508d923.js"><link rel="prefetch" href="/blog/assets/js/28.6d3a3926.js"><link rel="prefetch" href="/blog/assets/js/29.1d80c479.js"><link rel="prefetch" href="/blog/assets/js/3.8c172953.js"><link rel="prefetch" href="/blog/assets/js/30.34bf483b.js"><link rel="prefetch" href="/blog/assets/js/31.e416afee.js"><link rel="prefetch" href="/blog/assets/js/32.78191060.js"><link rel="prefetch" href="/blog/assets/js/33.787fa150.js"><link rel="prefetch" href="/blog/assets/js/34.83d3fa1e.js"><link rel="prefetch" href="/blog/assets/js/35.758f7354.js"><link rel="prefetch" href="/blog/assets/js/36.4fc20e4a.js"><link rel="prefetch" href="/blog/assets/js/37.516227a0.js"><link rel="prefetch" href="/blog/assets/js/38.984ec5bb.js"><link rel="prefetch" href="/blog/assets/js/39.6e70b5ca.js"><link rel="prefetch" href="/blog/assets/js/4.286f5b50.js"><link rel="prefetch" href="/blog/assets/js/40.3ce5d266.js"><link rel="prefetch" href="/blog/assets/js/41.04d9a371.js"><link rel="prefetch" href="/blog/assets/js/42.f9e63ded.js"><link rel="prefetch" href="/blog/assets/js/43.ac4d5aee.js"><link rel="prefetch" href="/blog/assets/js/44.1e8f4b25.js"><link rel="prefetch" href="/blog/assets/js/45.7b777d65.js"><link rel="prefetch" href="/blog/assets/js/46.96934414.js"><link rel="prefetch" href="/blog/assets/js/47.2406aee8.js"><link rel="prefetch" href="/blog/assets/js/48.371ab31c.js"><link rel="prefetch" href="/blog/assets/js/49.bd5be0a3.js"><link rel="prefetch" href="/blog/assets/js/5.967910cb.js"><link rel="prefetch" href="/blog/assets/js/50.3387825c.js"><link rel="prefetch" href="/blog/assets/js/51.9765871b.js"><link rel="prefetch" href="/blog/assets/js/52.eea392cb.js"><link rel="prefetch" href="/blog/assets/js/53.ee1c2a63.js"><link rel="prefetch" href="/blog/assets/js/54.6440a057.js"><link rel="prefetch" href="/blog/assets/js/55.fba17580.js"><link rel="prefetch" href="/blog/assets/js/56.ec7a617b.js"><link rel="prefetch" href="/blog/assets/js/57.a5b02e90.js"><link rel="prefetch" href="/blog/assets/js/58.acd13ae5.js"><link rel="prefetch" href="/blog/assets/js/59.63e4c77d.js"><link rel="prefetch" href="/blog/assets/js/6.95f5a1df.js"><link rel="prefetch" href="/blog/assets/js/60.059e8999.js"><link rel="prefetch" href="/blog/assets/js/61.3c8c64c6.js"><link rel="prefetch" href="/blog/assets/js/62.29f2d328.js"><link rel="prefetch" href="/blog/assets/js/63.fd04fdac.js"><link rel="prefetch" href="/blog/assets/js/64.3a515004.js"><link rel="prefetch" href="/blog/assets/js/65.cacaea7e.js"><link rel="prefetch" href="/blog/assets/js/66.ab62c848.js"><link rel="prefetch" href="/blog/assets/js/67.36d6f043.js"><link rel="prefetch" href="/blog/assets/js/68.ea171a47.js"><link rel="prefetch" href="/blog/assets/js/69.d81d52c7.js"><link rel="prefetch" href="/blog/assets/js/7.d1c12d08.js"><link rel="prefetch" href="/blog/assets/js/70.ed56051d.js"><link rel="prefetch" href="/blog/assets/js/71.8002c62d.js"><link rel="prefetch" href="/blog/assets/js/72.5415c4f8.js"><link rel="prefetch" href="/blog/assets/js/73.343c9e75.js"><link rel="prefetch" href="/blog/assets/js/74.540fa3f7.js"><link rel="prefetch" href="/blog/assets/js/75.517dd1ef.js"><link rel="prefetch" href="/blog/assets/js/76.2aec58c7.js"><link rel="prefetch" href="/blog/assets/js/77.22eb4605.js"><link rel="prefetch" href="/blog/assets/js/78.e8a10b94.js"><link rel="prefetch" href="/blog/assets/js/79.2026245e.js"><link rel="prefetch" href="/blog/assets/js/8.07533508.js"><link rel="prefetch" href="/blog/assets/js/80.47bf8af2.js"><link rel="prefetch" href="/blog/assets/js/81.85a9c4cc.js"><link rel="prefetch" href="/blog/assets/js/82.99464a5d.js"><link rel="prefetch" href="/blog/assets/js/83.89857466.js"><link rel="prefetch" href="/blog/assets/js/84.2535f1b2.js"><link rel="prefetch" href="/blog/assets/js/85.3fb68877.js"><link rel="prefetch" href="/blog/assets/js/86.4f401dab.js"><link rel="prefetch" href="/blog/assets/js/87.5eaeb89e.js"><link rel="prefetch" href="/blog/assets/js/88.77c09654.js"><link rel="prefetch" href="/blog/assets/js/89.3fca8870.js"><link rel="prefetch" href="/blog/assets/js/9.d0d2872d.js"><link rel="prefetch" href="/blog/assets/js/90.63d8c5d0.js"><link rel="prefetch" href="/blog/assets/js/91.5075603f.js"><link rel="prefetch" href="/blog/assets/js/92.63c5ea3b.js"><link rel="prefetch" href="/blog/assets/js/93.36e1c443.js"><link rel="prefetch" href="/blog/assets/js/94.af8b02f1.js"><link rel="prefetch" href="/blog/assets/js/95.cefba26c.js"><link rel="prefetch" href="/blog/assets/js/96.35a18ac0.js"><link rel="prefetch" href="/blog/assets/js/97.5a074780.js"><link rel="prefetch" href="/blog/assets/js/98.ef4e180d.js"><link rel="prefetch" href="/blog/assets/js/99.c3eb760b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.fb68c3ca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.jpg" alt="tanjiawen" class="logo"> <span class="site-name can-hide">tanjiawen</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/website/" class="nav-link">
  网站推荐
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试题" class="dropdown-title"><span class="title">面试题</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试题" class="mobile-dropdown-title"><span class="title">面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://interview2.poetries.top/docs/base.html#%E4%B8%80%E3%80%81html%E3%80%81http%E3%80%81web%E7%BB%BC%E5%90%88%E9%97%AE%E9%A2%98" target="_blank" rel="noopener noreferrer" class="nav-link external">
  面试题1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://wangtunan.github.io/blog/interview/#javascript%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E9%9D%A2%E8%AF%95%E9%A2%98" target="_blank" rel="noopener noreferrer" class="nav-link external">
  面试题2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="书籍" class="dropdown-title"><span class="title">书籍</span> <span class="arrow down"></span></button> <button type="button" aria-label="书籍" class="mobile-dropdown-title"><span class="title">书籍</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/books/js/es6/" class="nav-link">
  es6
</a></li></ul></li><li class="dropdown-item"><h4>
          web 3D
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.webgl3d.cn/WebGL/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  webgl
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://www.webgl3d.cn/Three.js/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  threejs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><!----> <a href="/blog/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/vite/" class="nav-link">
  vite
</a></li></ul></div></div><div class="nav-item"><a href="/blog/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/blog/node/base/01-环境搭建.html" class="nav-link">
  node
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Typescript" class="dropdown-title"><span class="title">Typescript</span> <span class="arrow down"></span></button> <button type="button" aria-label="Typescript" class="mobile-dropdown-title"><span class="title">Typescript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/typescript/base.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/blog/typescript/challenge.html" class="nav-link">
  高级api
</a></li></ul></div></div><div class="nav-item"><a href="/blog/other/resource-analysis/vue2.html" class="nav-link">
  other
</a></div><div class="nav-item"><a href="https://github.com/tjw-javen/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/website/" class="nav-link">
  网站推荐
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试题" class="dropdown-title"><span class="title">面试题</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试题" class="mobile-dropdown-title"><span class="title">面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://interview2.poetries.top/docs/base.html#%E4%B8%80%E3%80%81html%E3%80%81http%E3%80%81web%E7%BB%BC%E5%90%88%E9%97%AE%E9%A2%98" target="_blank" rel="noopener noreferrer" class="nav-link external">
  面试题1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://wangtunan.github.io/blog/interview/#javascript%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E9%9D%A2%E8%AF%95%E9%A2%98" target="_blank" rel="noopener noreferrer" class="nav-link external">
  面试题2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="书籍" class="dropdown-title"><span class="title">书籍</span> <span class="arrow down"></span></button> <button type="button" aria-label="书籍" class="mobile-dropdown-title"><span class="title">书籍</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/books/js/es6/" class="nav-link">
  es6
</a></li></ul></li><li class="dropdown-item"><h4>
          web 3D
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.webgl3d.cn/WebGL/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  webgl
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://www.webgl3d.cn/Three.js/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  threejs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><!----> <a href="/blog/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/vite/" class="nav-link">
  vite
</a></li></ul></div></div><div class="nav-item"><a href="/blog/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/blog/node/base/01-环境搭建.html" class="nav-link">
  node
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Typescript" class="dropdown-title"><span class="title">Typescript</span> <span class="arrow down"></span></button> <button type="button" aria-label="Typescript" class="mobile-dropdown-title"><span class="title">Typescript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/typescript/base.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/blog/typescript/challenge.html" class="nav-link">
  高级api
</a></li></ul></div></div><div class="nav-item"><a href="/blog/other/resource-analysis/vue2.html" class="nav-link">
  other
</a></div><div class="nav-item"><a href="https://github.com/tjw-javen/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深入浅出 Vue3</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue3 plain</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>书籍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>react</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/other/react/fiber.html" class="sidebar-link">fiber</a></li><li><a href="/blog/other/react/react-ref.html" aria-current="page" class="active sidebar-link">ref</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/other/react/react-ref.html#ref-的由来" class="sidebar-link">ref 的由来</a></li><li class="sidebar-sub-header"><a href="/blog/other/react/react-ref.html#ref-的四种方式" class="sidebar-link">ref 的四种方式</a></li><li class="sidebar-sub-header"><a href="/blog/other/react/react-ref.html#将被移除的-string-ref" class="sidebar-link">将被移除的 string ref</a></li><li class="sidebar-sub-header"><a href="/blog/other/react/react-ref.html#坚挺的-callback-ref" class="sidebar-link">坚挺的 callback ref</a></li><li class="sidebar-sub-header"><a href="/blog/other/react/react-ref.html#后来的-react-createref" class="sidebar-link">后来的 React.createRef</a></li><li class="sidebar-sub-header"><a href="/blog/other/react/react-ref.html#hooks大家族-useref" class="sidebar-link">hooks大家族 useRef</a></li><li class="sidebar-sub-header"><a href="/blog/other/react/react-ref.html#refs-转发" class="sidebar-link">Refs 转发</a></li><li class="sidebar-sub-header"><a href="/blog/other/react/react-ref.html#最后" class="sidebar-link">最后</a></li></ul></li><li><a href="/blog/other/react/react.html" class="sidebar-link">react</a></li><li><a href="/blog/other/react/react_function_or_class.html" class="sidebar-link">react_function_or_class</a></li><li><a href="/blog/other/react/react_hoc.html" class="sidebar-link">react_hoc</a></li><li><a href="/blog/other/react/redux.html" class="sidebar-link">redux</a></li><li><a href="/blog/other/react/useEffect.html" class="sidebar-link">useEffect</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node-study</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>other</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>rxjs</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react-ref-原来是这样的"><a href="#react-ref-原来是这样的" class="header-anchor">#</a> React ref 原来是这样的</h1> <p>最近开始研究React了，这篇文章主要是讲述 Ref 相关的内容，如有错误请指正。</p> <h2 id="ref-的由来"><a href="#ref-的由来" class="header-anchor">#</a> ref 的由来</h2> <p>在典型的 React 数据流中，props 是父组件与子组件交互的唯一方式。要修改一个子组件，你需要使用新的 props 来重新渲染它。但是，在某些情况下，你需要在典型数据流之外强制修改子组件/元素。</p> <p>适合使用 refs 的情况：</p> <ul><li>管理焦点，文本选择或媒体播放。</li> <li>触发强制动画。</li> <li>集成第三方 DOM 库。</li></ul> <h2 id="ref-的四种方式"><a href="#ref-的四种方式" class="header-anchor">#</a> ref 的四种方式</h2> <p>在 React v16.3 之前，ref 通过字符串（string ref）或者回调函数（callback ref）的形式进行获取。</p> <p>ref 通过字符获取：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// string ref</span>
<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>myRef<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token string">&quot;myRef&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ref 通过回调函数获取：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// callback ref</span>
<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>myRef<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">ele</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>myRef <span class="token operator">=</span> ele<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 v16.3 中，经 <a href="https://github.com/reactjs/rfcs/blob/master/text/0017-new-create-ref.md" target="_blank" rel="noopener noreferrer">0017-new-create-ref<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 提案引入了新的 API：<code>React.createRef</code>。</p> <p>ref 通过 React.createRef 获取：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// React.createRef</span>
<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>myRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>myRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>myRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然还有最近react大力推崇的 hooks：useRef</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> myRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">onButtonClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// `current` 指向已挂载到 DOM 上的文本输入元素</span>
    myRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>myRef<span class="token punctuation">}</span> type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onButtonClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>聚焦<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="将被移除的-string-ref"><a href="#将被移除的-string-ref" class="header-anchor">#</a> 将被移除的 string ref</h2> <p>首先来具体说说 <code>string ref</code>，string ref 就已被诟病已久，React 官方文档中如此声明：<code>&quot;如果你目前还在使用 this.refs.textInput 这种方式访问 refs ，我们建议用回调函数或 createRef API 的方式代替。&quot;</code>，为何如此糟糕？</p> <p>最初由 React 作者之一的 <code>dan abramov</code>。发布于<a href="https://news.ycombinator.com/edit?id=12093234" target="_blank" rel="noopener noreferrer">https://news.ycombinator.com/edit?id=12093234<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，（该网站需要梯子）。吐槽内容主要有以下几点：</p> <ol><li>string ref 不可组合。 例如一个第三方库的父组件已经给子组件传递了 ref，那么我们就无法在在子组件上添加 ref 了。 另一方面，回调引用没有一个所有者，因此您可以随时编写它们。例如：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/** string ref **/</span>
<span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 可获取到 this.refs.childRef</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> children <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
    <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">cloneElement</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      ref<span class="token operator">:</span> <span class="token string">'childRef'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// this.refs.child 无法获取到</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Parent<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Child ref<span class="token operator">=</span><span class="token string">&quot;child&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Parent<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>string ref 的所有者由当前执行的组件确定。 这意味着使用通用的“渲染回调”模式（例如react），错误的组件将拥有引用（它将最终在react上而不是您的组件定义renderRow）。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">renderRow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// string ref 会挂载在 DataTable this 上</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'input-'</span> <span class="token operator">+</span> index<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

    <span class="token comment">// callback ref 会挂载在 MyComponent this 上</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">input</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token string">'input-'</span> <span class="token operator">+</span> index<span class="token punctuation">]</span> <span class="token operator">=</span> input<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>DataTable data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>data<span class="token punctuation">}</span> renderRow<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>renderRow<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>string ref 不适用于Flow之类的静态分析。 Flow不能猜测框架可以使字符串ref“出现”在react上的神奇效果，以及它的类型（可能有所不同）。 回调引用比静态分析更友好。</li> <li>string ref 强制React跟踪当前正在执行的组件。 这是有问题的，因为它使react模块处于有状态，并在捆绑中复制react模块时导致奇怪的错误。在 reconciliation 阶段，React Element 创建和更新的过程中，ref 会被封装为一个闭包函数，等待 commit 阶段被执行，这会对 React 的性能产生一些影响。</li></ol> <p>关于这点可以参考 React 源码 <code>coerceRef</code> 的实现：</p> <p>在调和子节点得过程中，会对 string ref 进行处理，把他转换成一个方法，这个方法主要做的事情就是设置 instance.refs[stringRef] = element，相当于把他转换成了function ref</p> <p>对于更新得过程中string ref是否变化需要对比得是 current.ref._stringRef，这里记录了上一次渲染得时候如果使用得是string ref他的值是什么</p> <p>owner是在调用createElement的时候获取的，通过ReactCurrentOwner.current获取，这个值在更新一个组件前会被设置，比如更新ClassComponent的时候，调用render方法之前会设置，然后调用render的时候就可以获取对应的owner了。</p> <h2 id="坚挺的-callback-ref"><a href="#坚挺的-callback-ref" class="header-anchor">#</a> 坚挺的 callback ref</h2> <p>React 将在组件挂载时，会调用 ref 回调函数并传入 DOM 元素，当卸载时调用它并传入 null。在 componentDidMount 或 componentDidUpdate 触发前，React 会保证 refs 一定是最新的。</p> <p>如果 ref 回调函数是以内联函数的方式定义的，在更新过程中它会被执行两次，第一次传入参数 null，然后第二次会传入参数 DOM 元素。这是因为在每次渲染时会创建一个新的函数实例，所以 React 清空旧的 ref 并且设置新的。通过将 ref 的回调函数定义成 class 的绑定函数的方式可以避免上述问题，但是大多数情况下它是无关紧要的。</p> <h2 id="后来的-react-createref"><a href="#后来的-react-createref" class="header-anchor">#</a> 后来的 React.createRef</h2> <p>React.createRef 的优点：</p> <ul><li>相对于 callback ref 而言 React.createRef 显得更加直观，避免了 callback ref 的一些理解问题。</li></ul> <p>React.createRef 的缺点：</p> <ol><li>性能略低于 callback ref</li> <li>能力上仍逊色于 callback ref，例如上一节提到的组合问题，createRef 也是无能为力的。</li></ol> <p>ref 的值根据节点的类型而有所不同：</p> <ul><li>当 ref 属性用于 HTML 元素时，构造函数中使用 React.createRef() 创建的 ref 接收底层 DOM 元素作为其 current 属性。</li> <li>当 ref 属性用于自定义 class 组件时，ref 对象接收组件的挂载实例作为其 current 属性。</li> <li>默认情况下，你不能在函数组件上使用 ref 属性（可以在函数组件内部使用），因为它们没有实例：
<ul><li>如果要在函数组件中使用 ref，你可以使用 forwardRef（可与 useImperativeHandle 结合使用）</li> <li>或者可以将该组件转化为 class 组件。</li></ul></li></ul> <h2 id="hooks大家族-useref"><a href="#hooks大家族-useref" class="header-anchor">#</a> hooks大家族 useRef</h2> <p>这第四种使用 ref 的方法又有何不同呢？</p> <p><code>useRef</code> 返回一个可变的 ref 对象，其 <code>.current</code> 属性被初始化为传入的参数（initialValue）。<strong>返回的 ref 对象在组件的整个生命周期内保持不变</strong>。并且 useRef 可以很方便地保存任何可变值，其类似于在 class 中使用实例字段的方式。</p> <p>正是由于这些特性，<code>useRef</code> 和 <code>createRef</code> 出现了很大差异。</p> <p>可以运行下以下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> latestCount <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    latestCount<span class="token punctuation">.</span>current <span class="token operator">=</span> count<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleAlertclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;latestCount.current:&quot;</span> <span class="token operator">+</span> latestCount<span class="token punctuation">.</span>current <span class="token operator">+</span> <span class="token string">'.. count: '</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>当前count： <span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleAlertclick<span class="token punctuation">}</span><span class="token operator">&gt;</span> 提示 <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后按照下面步骤进行操作：</p> <ol><li>连续点击5次 <code>count + 1</code> 按钮</li> <li>点击 <code>提示</code> 按钮</li> <li>再点击完 <code>提示</code> 按钮后2秒内连续点击2次 <code>count + 1</code> 按钮</li> <li>等待 alert 弹窗提示。</li></ol> <p>然后会你会得到一个有趣的答案：alert 弹窗会提示： <code>latestCount.current:7.. count: 5</code>。使用 <code>useRef</code> 能获取到最新的值，但是 <code>useState</code> 却不能。</p> <p>具体原因可以参考 react 作者之一 dan 的个人博客。或者查看 <a href="https://juejin.im/post/6844904049146331150" target="_blank" rel="noopener noreferrer">React 函数式组件和类组件的区别，不是只有state和性能！<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>那么 useRef 真有那么很好用吗？并不是的。还有由于它上面的那个特性，问题还是不少的。</p> <p>你可以尝试跑一下下面这段代码，或者 <a href="https://codesandbox.io/s/1rvwnj71x3" target="_blank" rel="noopener noreferrer">点击这里查看<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> createRef<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>renderIndex<span class="token punctuation">,</span> setRenderIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> refFromUseRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> refFromCreateRef <span class="token operator">=</span> <span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>refFromUseRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 赋值操作</span>
    refFromUseRef<span class="token punctuation">.</span>current <span class="token operator">=</span> renderIndex<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>refFromCreateRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 赋值操作</span>
    refFromCreateRef<span class="token punctuation">.</span>current <span class="token operator">=</span> renderIndex<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;App&quot;</span><span class="token operator">&gt;</span>
      Current render index<span class="token operator">:</span> <span class="token punctuation">{</span>renderIndex<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">&gt;</span>
      在refFromUseRef<span class="token punctuation">.</span>current中记住的第一个渲染索引：
      <span class="token punctuation">{</span>refFromUseRef<span class="token punctuation">.</span>current<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">&gt;</span>
      在refFromCreateRef<span class="token punctuation">.</span>current中未能成功记住第一个渲染索引：
      <span class="token punctuation">{</span>refFromCreateRef<span class="token punctuation">.</span>current<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span>br <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setRenderIndex</span><span class="token punctuation">(</span><span class="token parameter">prev</span> <span class="token operator">=&gt;</span> prev <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
        数值 <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> rootElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> rootElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的案例中无论如何点击按钮 <code>refFromUseRef.current</code> 将始终为 <code>1</code>，而 <code>renderIndex</code> 和 <code>refFromCreateRef.current</code> 会伴随点击事件改变; 意想不到吧？</p> <p>因为：当 ref 对象内容发生变化时，useRef 并不会通知你。变更 <code>.current</code> 属性不会引发组件重新渲染。如果想要在 React 绑定或解绑 DOM 节点的 ref 时运行某些代码，则需要使用 <code>callback ref</code> 来实现。</p> <p>总结下：</p> <ol><li>useRef 可以获取 DOM ref</li> <li>useRef 可以获取最新的值</li> <li>useRef 内容发生改变并不会通知</li></ol> <p>由于上面的一些问题，起初我也是并不想把 useRef 作为操作 ref 的方法来讲的。</p> <h2 id="refs-转发"><a href="#refs-转发" class="header-anchor">#</a> Refs 转发</h2> <h4 id="是否需要将-dom-refs-暴露给父组件"><a href="#是否需要将-dom-refs-暴露给父组件" class="header-anchor">#</a> 是否需要将 DOM Refs 暴露给父组件？</h4> <p>在极少数情况下，你可能希望在父组件中引用子节点的 DOM 节点。通常不建议这样做，因为它会打破组件的封装，但它偶尔可用于触发焦点或测量子 DOM 节点的大小或位置。</p> <h4 id="如何将-ref-暴露给父组件"><a href="#如何将-ref-暴露给父组件" class="header-anchor">#</a> 如何将 ref 暴露给父组件？</h4> <p>如果你使用 16.3 或更高版本的 React, 这种情况下我们推荐使用 ref 转发。Ref 转发使组件可以像暴露自己的 ref 一样暴露子组件的 ref。</p> <p>什么是 ref 转发？</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> FancyButton <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>button ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> className<span class="token operator">=</span><span class="token string">&quot;FancyButton&quot;</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 你可以直接获取 DOM button 的 ref：</span>
<span class="token keyword">const</span> ref <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>FancyButton ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span><span class="token operator">&gt;</span>Click me<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>FancyButton<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><p>如果在低版本中如何转发？</p> <p>如果你使用 16.2 或更低版本的 React，或者你需要比 ref 转发更高的灵活性，你可以使用 ref 作为特殊名字的 prop 直接传递。</p> <p>比如下面这样：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">CustomTextInput</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>inputRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>inputElement <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>CustomTextInput inputRef<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>inputElement<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以下是对上述示例发生情况的逐步解释：</p> <ol><li>我们通过调用 React.createRef 创建了一个 React ref 并将其赋值给 ref 变量。</li> <li>我们通过指定 ref 为 JSX 属性，将其向下传递给 <code>&lt;FancyButton ref={ref}&gt;</code>。</li> <li>React 传递 ref 给 forwardRef 内函数 (props, ref) =&gt; ...，作为其第二个参数。</li> <li>我们向下转发该 ref 参数到 <code>&lt;button ref={ref}&gt;</code>，将其指定为 JSX 属性。</li> <li>当 ref 挂载完成，ref.current 将指向 <code>&lt;button&gt;</code> DOM 节点。</li></ol> <h2 id="最后"><a href="#最后" class="header-anchor">#</a> 最后</h2> <p>欢迎关注公众号 <strong><a href="http://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/292c68443dec4a2ab17208a5d08222fe~tplv-k3u1fbpfcp-zoom-1.image" target="_blank" rel="noopener noreferrer">前端进阶课<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong> 认真学前端，一起进阶。回复 <code>全栈</code> 或 <code>Vue</code> 有好礼相送哦。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/10/2022, 12:08:04 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/other/react/fiber.html" class="prev">
        fiber
      </a></span> <span class="next"><a href="/blog/other/react/react.html">
        react
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.a9945600.js" defer></script><script src="/blog/assets/js/2.3af135cd.js" defer></script><script src="/blog/assets/js/153.6de516b6.js" defer></script>
  </body>
</html>
