<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>文件读取 | tanjiawen</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog/icon.png">
    <meta name="description" content="Just do it">
    
    <link rel="preload" href="/blog/assets/css/0.styles.fb68c3ca.css" as="style"><link rel="preload" href="/blog/assets/js/app.a9945600.js" as="script"><link rel="preload" href="/blog/assets/js/2.3af135cd.js" as="script"><link rel="preload" href="/blog/assets/js/92.63c5ea3b.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.8284ffc7.js"><link rel="prefetch" href="/blog/assets/js/100.f43ee495.js"><link rel="prefetch" href="/blog/assets/js/101.af588b87.js"><link rel="prefetch" href="/blog/assets/js/102.fceaf7cd.js"><link rel="prefetch" href="/blog/assets/js/103.237512b5.js"><link rel="prefetch" href="/blog/assets/js/104.5b0b5556.js"><link rel="prefetch" href="/blog/assets/js/105.377afdf9.js"><link rel="prefetch" href="/blog/assets/js/106.6c8faab0.js"><link rel="prefetch" href="/blog/assets/js/107.f05b17b2.js"><link rel="prefetch" href="/blog/assets/js/108.24380ae4.js"><link rel="prefetch" href="/blog/assets/js/109.4fc3aa4f.js"><link rel="prefetch" href="/blog/assets/js/11.9e763810.js"><link rel="prefetch" href="/blog/assets/js/110.9872b4b9.js"><link rel="prefetch" href="/blog/assets/js/111.8be8fde4.js"><link rel="prefetch" href="/blog/assets/js/112.9f21b37f.js"><link rel="prefetch" href="/blog/assets/js/113.5d6d8b94.js"><link rel="prefetch" href="/blog/assets/js/114.ae32905e.js"><link rel="prefetch" href="/blog/assets/js/115.6c90fdfc.js"><link rel="prefetch" href="/blog/assets/js/116.4c181179.js"><link rel="prefetch" href="/blog/assets/js/117.b775cf93.js"><link rel="prefetch" href="/blog/assets/js/118.1cc72273.js"><link rel="prefetch" href="/blog/assets/js/119.e1c025d6.js"><link rel="prefetch" href="/blog/assets/js/12.06a3d36d.js"><link rel="prefetch" href="/blog/assets/js/120.4932db4b.js"><link rel="prefetch" href="/blog/assets/js/121.276f05eb.js"><link rel="prefetch" href="/blog/assets/js/122.26d84809.js"><link rel="prefetch" href="/blog/assets/js/123.a1dcb4d5.js"><link rel="prefetch" href="/blog/assets/js/124.bc51e9ad.js"><link rel="prefetch" href="/blog/assets/js/125.f1c600f6.js"><link rel="prefetch" href="/blog/assets/js/126.4a939469.js"><link rel="prefetch" href="/blog/assets/js/127.de1057e9.js"><link rel="prefetch" href="/blog/assets/js/128.47b26a21.js"><link rel="prefetch" href="/blog/assets/js/129.375e29fe.js"><link rel="prefetch" href="/blog/assets/js/13.5f19c836.js"><link rel="prefetch" href="/blog/assets/js/130.2f5f1157.js"><link rel="prefetch" href="/blog/assets/js/131.41c79642.js"><link rel="prefetch" href="/blog/assets/js/132.bf263adf.js"><link rel="prefetch" href="/blog/assets/js/133.e2199dcd.js"><link rel="prefetch" href="/blog/assets/js/134.a8b03f50.js"><link rel="prefetch" href="/blog/assets/js/135.6ec46987.js"><link rel="prefetch" href="/blog/assets/js/136.8b3fdace.js"><link rel="prefetch" href="/blog/assets/js/137.a427c5c6.js"><link rel="prefetch" href="/blog/assets/js/138.1cf3e855.js"><link rel="prefetch" href="/blog/assets/js/139.63e6b0c6.js"><link rel="prefetch" href="/blog/assets/js/14.51a8431a.js"><link rel="prefetch" href="/blog/assets/js/140.9615b46c.js"><link rel="prefetch" href="/blog/assets/js/141.230b60ba.js"><link rel="prefetch" href="/blog/assets/js/142.8eda03ee.js"><link rel="prefetch" href="/blog/assets/js/143.c4d976f1.js"><link rel="prefetch" href="/blog/assets/js/144.699fc7ec.js"><link rel="prefetch" href="/blog/assets/js/145.e3ab15da.js"><link rel="prefetch" href="/blog/assets/js/146.08905a96.js"><link rel="prefetch" href="/blog/assets/js/147.09ca7dfc.js"><link rel="prefetch" href="/blog/assets/js/148.45af3dc5.js"><link rel="prefetch" href="/blog/assets/js/149.c3b4d241.js"><link rel="prefetch" href="/blog/assets/js/15.72a92a5e.js"><link rel="prefetch" href="/blog/assets/js/150.6b86563f.js"><link rel="prefetch" href="/blog/assets/js/151.804e4177.js"><link rel="prefetch" href="/blog/assets/js/152.70cc135c.js"><link rel="prefetch" href="/blog/assets/js/153.6de516b6.js"><link rel="prefetch" href="/blog/assets/js/154.c642c181.js"><link rel="prefetch" href="/blog/assets/js/155.b59c4d7f.js"><link rel="prefetch" href="/blog/assets/js/156.ee19c90e.js"><link rel="prefetch" href="/blog/assets/js/157.e249f132.js"><link rel="prefetch" href="/blog/assets/js/158.f49f881b.js"><link rel="prefetch" href="/blog/assets/js/159.ee57b260.js"><link rel="prefetch" href="/blog/assets/js/16.ef643ba6.js"><link rel="prefetch" href="/blog/assets/js/160.3f1f373b.js"><link rel="prefetch" href="/blog/assets/js/161.8f3bf814.js"><link rel="prefetch" href="/blog/assets/js/162.be1644a6.js"><link rel="prefetch" href="/blog/assets/js/163.54bfb0d9.js"><link rel="prefetch" href="/blog/assets/js/164.c7630457.js"><link rel="prefetch" href="/blog/assets/js/165.48921b01.js"><link rel="prefetch" href="/blog/assets/js/166.ff957762.js"><link rel="prefetch" href="/blog/assets/js/167.952152c7.js"><link rel="prefetch" href="/blog/assets/js/168.18858c2d.js"><link rel="prefetch" href="/blog/assets/js/169.cfa7b9d3.js"><link rel="prefetch" href="/blog/assets/js/17.a2ce8782.js"><link rel="prefetch" href="/blog/assets/js/170.2f675b22.js"><link rel="prefetch" href="/blog/assets/js/171.3a66756a.js"><link rel="prefetch" href="/blog/assets/js/172.842fd9e9.js"><link rel="prefetch" href="/blog/assets/js/173.5bba42f1.js"><link rel="prefetch" href="/blog/assets/js/174.b3b3ea12.js"><link rel="prefetch" href="/blog/assets/js/18.7f01d8ef.js"><link rel="prefetch" href="/blog/assets/js/19.e3513f33.js"><link rel="prefetch" href="/blog/assets/js/20.03616f12.js"><link rel="prefetch" href="/blog/assets/js/21.2298db57.js"><link rel="prefetch" href="/blog/assets/js/22.74c0e9e0.js"><link rel="prefetch" href="/blog/assets/js/23.f3fca169.js"><link rel="prefetch" href="/blog/assets/js/24.76042ebf.js"><link rel="prefetch" href="/blog/assets/js/25.565736de.js"><link rel="prefetch" href="/blog/assets/js/26.a780b1d1.js"><link rel="prefetch" href="/blog/assets/js/27.9508d923.js"><link rel="prefetch" href="/blog/assets/js/28.6d3a3926.js"><link rel="prefetch" href="/blog/assets/js/29.1d80c479.js"><link rel="prefetch" href="/blog/assets/js/3.8c172953.js"><link rel="prefetch" href="/blog/assets/js/30.34bf483b.js"><link rel="prefetch" href="/blog/assets/js/31.e416afee.js"><link rel="prefetch" href="/blog/assets/js/32.78191060.js"><link rel="prefetch" href="/blog/assets/js/33.787fa150.js"><link rel="prefetch" href="/blog/assets/js/34.83d3fa1e.js"><link rel="prefetch" href="/blog/assets/js/35.758f7354.js"><link rel="prefetch" href="/blog/assets/js/36.4fc20e4a.js"><link rel="prefetch" href="/blog/assets/js/37.516227a0.js"><link rel="prefetch" href="/blog/assets/js/38.984ec5bb.js"><link rel="prefetch" href="/blog/assets/js/39.6e70b5ca.js"><link rel="prefetch" href="/blog/assets/js/4.286f5b50.js"><link rel="prefetch" href="/blog/assets/js/40.3ce5d266.js"><link rel="prefetch" href="/blog/assets/js/41.04d9a371.js"><link rel="prefetch" href="/blog/assets/js/42.f9e63ded.js"><link rel="prefetch" href="/blog/assets/js/43.ac4d5aee.js"><link rel="prefetch" href="/blog/assets/js/44.1e8f4b25.js"><link rel="prefetch" href="/blog/assets/js/45.7b777d65.js"><link rel="prefetch" href="/blog/assets/js/46.96934414.js"><link rel="prefetch" href="/blog/assets/js/47.2406aee8.js"><link rel="prefetch" href="/blog/assets/js/48.371ab31c.js"><link rel="prefetch" href="/blog/assets/js/49.bd5be0a3.js"><link rel="prefetch" href="/blog/assets/js/5.967910cb.js"><link rel="prefetch" href="/blog/assets/js/50.3387825c.js"><link rel="prefetch" href="/blog/assets/js/51.9765871b.js"><link rel="prefetch" href="/blog/assets/js/52.eea392cb.js"><link rel="prefetch" href="/blog/assets/js/53.ee1c2a63.js"><link rel="prefetch" href="/blog/assets/js/54.6440a057.js"><link rel="prefetch" href="/blog/assets/js/55.fba17580.js"><link rel="prefetch" href="/blog/assets/js/56.ec7a617b.js"><link rel="prefetch" href="/blog/assets/js/57.a5b02e90.js"><link rel="prefetch" href="/blog/assets/js/58.acd13ae5.js"><link rel="prefetch" href="/blog/assets/js/59.63e4c77d.js"><link rel="prefetch" href="/blog/assets/js/6.95f5a1df.js"><link rel="prefetch" href="/blog/assets/js/60.059e8999.js"><link rel="prefetch" href="/blog/assets/js/61.3c8c64c6.js"><link rel="prefetch" href="/blog/assets/js/62.29f2d328.js"><link rel="prefetch" href="/blog/assets/js/63.fd04fdac.js"><link rel="prefetch" href="/blog/assets/js/64.3a515004.js"><link rel="prefetch" href="/blog/assets/js/65.cacaea7e.js"><link rel="prefetch" href="/blog/assets/js/66.ab62c848.js"><link rel="prefetch" href="/blog/assets/js/67.36d6f043.js"><link rel="prefetch" href="/blog/assets/js/68.ea171a47.js"><link rel="prefetch" href="/blog/assets/js/69.d81d52c7.js"><link rel="prefetch" href="/blog/assets/js/7.d1c12d08.js"><link rel="prefetch" href="/blog/assets/js/70.ed56051d.js"><link rel="prefetch" href="/blog/assets/js/71.8002c62d.js"><link rel="prefetch" href="/blog/assets/js/72.5415c4f8.js"><link rel="prefetch" href="/blog/assets/js/73.343c9e75.js"><link rel="prefetch" href="/blog/assets/js/74.540fa3f7.js"><link rel="prefetch" href="/blog/assets/js/75.517dd1ef.js"><link rel="prefetch" href="/blog/assets/js/76.2aec58c7.js"><link rel="prefetch" href="/blog/assets/js/77.22eb4605.js"><link rel="prefetch" href="/blog/assets/js/78.e8a10b94.js"><link rel="prefetch" href="/blog/assets/js/79.2026245e.js"><link rel="prefetch" href="/blog/assets/js/8.07533508.js"><link rel="prefetch" href="/blog/assets/js/80.47bf8af2.js"><link rel="prefetch" href="/blog/assets/js/81.85a9c4cc.js"><link rel="prefetch" href="/blog/assets/js/82.99464a5d.js"><link rel="prefetch" href="/blog/assets/js/83.89857466.js"><link rel="prefetch" href="/blog/assets/js/84.2535f1b2.js"><link rel="prefetch" href="/blog/assets/js/85.3fb68877.js"><link rel="prefetch" href="/blog/assets/js/86.4f401dab.js"><link rel="prefetch" href="/blog/assets/js/87.5eaeb89e.js"><link rel="prefetch" href="/blog/assets/js/88.77c09654.js"><link rel="prefetch" href="/blog/assets/js/89.3fca8870.js"><link rel="prefetch" href="/blog/assets/js/9.d0d2872d.js"><link rel="prefetch" href="/blog/assets/js/90.63d8c5d0.js"><link rel="prefetch" href="/blog/assets/js/91.5075603f.js"><link rel="prefetch" href="/blog/assets/js/93.36e1c443.js"><link rel="prefetch" href="/blog/assets/js/94.af8b02f1.js"><link rel="prefetch" href="/blog/assets/js/95.cefba26c.js"><link rel="prefetch" href="/blog/assets/js/96.35a18ac0.js"><link rel="prefetch" href="/blog/assets/js/97.5a074780.js"><link rel="prefetch" href="/blog/assets/js/98.ef4e180d.js"><link rel="prefetch" href="/blog/assets/js/99.c3eb760b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.fb68c3ca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.jpg" alt="tanjiawen" class="logo"> <span class="site-name can-hide">tanjiawen</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/website/" class="nav-link">
  网站推荐
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试题" class="dropdown-title"><span class="title">面试题</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试题" class="mobile-dropdown-title"><span class="title">面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://interview2.poetries.top/docs/base.html#%E4%B8%80%E3%80%81html%E3%80%81http%E3%80%81web%E7%BB%BC%E5%90%88%E9%97%AE%E9%A2%98" target="_blank" rel="noopener noreferrer" class="nav-link external">
  面试题1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://wangtunan.github.io/blog/interview/#javascript%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E9%9D%A2%E8%AF%95%E9%A2%98" target="_blank" rel="noopener noreferrer" class="nav-link external">
  面试题2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="书籍" class="dropdown-title"><span class="title">书籍</span> <span class="arrow down"></span></button> <button type="button" aria-label="书籍" class="mobile-dropdown-title"><span class="title">书籍</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/books/js/es6/" class="nav-link">
  es6
</a></li></ul></li><li class="dropdown-item"><h4>
          web 3D
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.webgl3d.cn/WebGL/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  webgl
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://www.webgl3d.cn/Three.js/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  threejs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><!----> <a href="/blog/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/vite/" class="nav-link">
  vite
</a></li></ul></div></div><div class="nav-item"><a href="/blog/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/blog/node/base/01-环境搭建.html" class="nav-link">
  node
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Typescript" class="dropdown-title"><span class="title">Typescript</span> <span class="arrow down"></span></button> <button type="button" aria-label="Typescript" class="mobile-dropdown-title"><span class="title">Typescript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/typescript/base.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/blog/typescript/challenge.html" class="nav-link">
  高级api
</a></li></ul></div></div><div class="nav-item"><a href="/blog/other/resource-analysis/vue2.html" class="nav-link">
  other
</a></div><div class="nav-item"><a href="https://github.com/tjw-javen/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/website/" class="nav-link">
  网站推荐
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试题" class="dropdown-title"><span class="title">面试题</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试题" class="mobile-dropdown-title"><span class="title">面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://interview2.poetries.top/docs/base.html#%E4%B8%80%E3%80%81html%E3%80%81http%E3%80%81web%E7%BB%BC%E5%90%88%E9%97%AE%E9%A2%98" target="_blank" rel="noopener noreferrer" class="nav-link external">
  面试题1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://wangtunan.github.io/blog/interview/#javascript%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E9%9D%A2%E8%AF%95%E9%A2%98" target="_blank" rel="noopener noreferrer" class="nav-link external">
  面试题2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="书籍" class="dropdown-title"><span class="title">书籍</span> <span class="arrow down"></span></button> <button type="button" aria-label="书籍" class="mobile-dropdown-title"><span class="title">书籍</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          js
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/books/js/es6/" class="nav-link">
  es6
</a></li></ul></li><li class="dropdown-item"><h4>
          web 3D
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="http://www.webgl3d.cn/WebGL/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  webgl
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="http://www.webgl3d.cn/Three.js/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  threejs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><!----> <a href="/blog/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/vite/" class="nav-link">
  vite
</a></li></ul></div></div><div class="nav-item"><a href="/blog/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="/blog/node/base/01-环境搭建.html" class="nav-link">
  node
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Typescript" class="dropdown-title"><span class="title">Typescript</span> <span class="arrow down"></span></button> <button type="button" aria-label="Typescript" class="mobile-dropdown-title"><span class="title">Typescript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/typescript/base.html" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/blog/typescript/challenge.html" class="nav-link">
  高级api
</a></li></ul></div></div><div class="nav-item"><a href="/blog/other/resource-analysis/vue2.html" class="nav-link">
  other
</a></div><div class="nav-item"><a href="https://github.com/tjw-javen/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基础篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/node/base/01-环境搭建.html" class="sidebar-link">环境搭建</a></li><li><a href="/blog/node/base/02-node部署.html" class="sidebar-link">node部署</a></li><li><a href="/blog/node/base/03-基础应用.html" class="sidebar-link">基础应用</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>内置模块</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/node/modules/-1.0 本地路径处理 path.html" class="sidebar-link">1.0 本地路径处理 path</a></li><li><a href="/blog/node/modules/-2.0 文件系统操作 fs.html" class="active sidebar-link">2.0 文件系统操作 fs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#文件读取" class="sidebar-link">文件读取</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#普通读取" class="sidebar-link">普通读取</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#通过文件流读取" class="sidebar-link">通过文件流读取</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#文件写入" class="sidebar-link">文件写入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#通过文件流写入" class="sidebar-link">通过文件流写入</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#相对底层的接口" class="sidebar-link">相对底层的接口</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#文件是否存在" class="sidebar-link">文件是否存在</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#创建目录" class="sidebar-link">创建目录</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#删除文件" class="sidebar-link">删除文件</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#创建目录-2" class="sidebar-link">创建目录</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#遍历目录" class="sidebar-link">遍历目录</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#文件重命名" class="sidebar-link">文件重命名</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#监听文件修改" class="sidebar-link">监听文件修改</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#fs-watchfile" class="sidebar-link">fs.watchFile()</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#fs-watch" class="sidebar-link">fs.watch()</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#修改所有者" class="sidebar-link">修改所有者</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#修改权限" class="sidebar-link">修改权限</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#获取文件状态" class="sidebar-link">获取文件状态</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#访问-权限检测" class="sidebar-link">访问/权限检测</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#文件打开-关闭" class="sidebar-link">文件打开/关闭</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#文件读取-底层" class="sidebar-link">文件读取（底层）</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#追加文件内容" class="sidebar-link">追加文件内容</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#文件内容截取" class="sidebar-link">文件内容截取</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#修改文件属性-时间" class="sidebar-link">修改文件属性（时间）</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#创建文件链接" class="sidebar-link">创建文件链接</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#创建临时目录" class="sidebar-link">创建临时目录</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#找出软连接指向的真实路径" class="sidebar-link">找出软连接指向的真实路径</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#真实路径" class="sidebar-link">真实路径</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#删除目录" class="sidebar-link">删除目录</a></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#不常用" class="sidebar-link">不常用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#缓冲区内容写到磁盘" class="sidebar-link">缓冲区内容写到磁盘</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/node/modules/-2.0 文件系统操作 fs.html#待确认" class="sidebar-link">待确认</a></li></ul></li><li><a href="/blog/node/modules/-3.1 基础调试 console.html" class="sidebar-link">3.1 基础调试 console</a></li><li><a href="/blog/node/modules/-3.2 本地调试远程服务器上的Node代码.html" class="sidebar-link">3.2 本地调试远程服务器上的Node代码</a></li><li><a href="/blog/node/modules/-4.1 网络服务 http.html" class="sidebar-link">4.1 网络服务 http</a></li><li><a href="/blog/node/modules/-4.2 网络服务 http res.html" class="sidebar-link">4.2 网络服务 http res</a></li><li><a href="/blog/node/modules/-4.3 网络服务 http req.html" class="sidebar-link">4.3 网络服务 http req</a></li><li><a href="/blog/node/modules/-4.4 网络服务 http server.html" class="sidebar-link">4.4 网络服务 http server</a></li><li><a href="/blog/node/modules/-4.5 网络服务 http client.html" class="sidebar-link">4.5 网络服务 http client</a></li><li><a href="/blog/node/modules/-4.6 网络服务 https.html" class="sidebar-link">4.6 网络服务 https</a></li><li><a href="/blog/node/modules/-4.7 网络TCP net.html" class="sidebar-link">4.7 网络TCP net</a></li><li><a href="/blog/node/modules/-4.8 网络UDP dgram.html" class="sidebar-link">4.8 网络UDP dgram</a></li><li><a href="/blog/node/modules/-4.9 域名解析 dns.html" class="sidebar-link">4.9 域名解析 dns</a></li><li><a href="/blog/node/modules/-5.0 网络地址解析 url.html" class="sidebar-link">5.0 网络地址解析 url</a></li><li><a href="/blog/node/modules/-5.1 URL查询字符串 querystring.html" class="sidebar-link">5.1 URL查询字符串 querystring</a></li><li><a href="/blog/node/modules/-6.1 流操作 stream.html" class="sidebar-link">6.1 流操作 stream</a></li><li><a href="/blog/node/modules/-6.2 逐行读取 readline.html" class="sidebar-link">6.2 逐行读取 readline</a></li><li><a href="/blog/node/modules/-7.1 进程相关 process.html" class="sidebar-link">7.1 进程相关 process</a></li><li><a href="/blog/node/modules/-7.2 子进程 child.html" class="sidebar-link">7.2 子进程 child</a></li><li><a href="/blog/node/modules/-8.1 二进制数据 buffer.html" class="sidebar-link">8.1 二进制数据 buffer</a></li><li><a href="/blog/node/modules/-8.2 二进制解码 string_decoder.html" class="sidebar-link">8.2 二进制解码 string_decoder</a></li><li><a href="/blog/node/modules/-9.1 事件机制 events.html" class="sidebar-link">9.1 事件机制 events</a></li><li><a href="/blog/node/modules/-9.2 实用工具模块 util.html" class="sidebar-link">9.2 实用工具模块 util</a></li><li><a href="/blog/node/modules/-9.3 数据加密 crypto.html" class="sidebar-link">9.3 数据加密 crypto</a></li><li><a href="/blog/node/modules/-9.4 MD5入门介绍及crypto模块的应用.html" class="sidebar-link">9.4 MD5入门介绍及crypto模块的应用</a></li><li><a href="/blog/node/modules/-9.4 资源压缩 zlib.html" class="sidebar-link">9.4 资源压缩 zlib</a></li><li><a href="/blog/node/modules/-9.5 集群 cluster.html" class="sidebar-link">9.5 集群 cluster</a></li><li><a href="/blog/node/modules/-9.6 v8.html" class="sidebar-link">9.6 v8</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>进阶篇</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Express</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Koa2</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nest</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/node/other/01-操作数据库.html" class="sidebar-link">操作数据库</a></li><li><a href="/blog/node/other/02-Session 与 Token.html" class="sidebar-link">Session 与 Token</a></li><li><a href="/blog/node/other/03-Cookie、Session、Token、JWT.html" class="sidebar-link">Cookie、Session、Token、JWT</a></li><li><a href="/blog/node/other/04-Socket.html" class="sidebar-link">Socket</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="文件读取"><a href="#文件读取" class="header-anchor">#</a> 文件读取</h2> <h3 id="普通读取"><a href="#普通读取" class="header-anchor">#</a> 普通读取</h3> <p>同步读取</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> data<span class="token punctuation">;</span>

<span class="token keyword">try</span><span class="token punctuation">{</span>
    data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./fileForRead.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件内容: '</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'读取文件出错: '</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>输出如下：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>node readFileSync<span class="token punctuation">.</span>js
文件内容: hello world
</code></pre></div><p>异步读取</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./fileForRead.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'读取文件出错: '</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件内容: '</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出如下</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>node readFile<span class="token punctuation">.</span>js
文件内容: hello world
</code></pre></div><h3 id="通过文件流读取"><a href="#通过文件流读取" class="header-anchor">#</a> 通过文件流读取</h3> <p>适合读取大文件</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> readStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./fileForRead.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

readStream
    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取数据: '</span> <span class="token operator">+</span> chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'出错: '</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// 没有数据了</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'没有数据了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// 已经关闭，不会再有事件抛出</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'已经关闭'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出如下</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>node createReadStream<span class="token punctuation">.</span>js
读取数据: hello world
没有数据了
已经关闭
</code></pre></div><h2 id="文件写入"><a href="#文件写入" class="header-anchor">#</a> 文件写入</h2> <p>备注：以下代码，如果文件不存在，则创建文件；如果文件存在，则覆盖文件内容；</p> <p>异步写入</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./fileForWrite.txt'</span><span class="token punctuation">,</span> <span class="token string">'hello world'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件写入成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>同步写入</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span><span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'./fileForWrite1.txt'</span><span class="token punctuation">,</span> <span class="token string">'hello world'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件写入成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="通过文件流写入"><a href="#通过文件流写入" class="header-anchor">#</a> 通过文件流写入</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> writeStream <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'./fileForWrite1.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

writeStream
    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">// 已经关闭，不会再有事件抛出</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'已经关闭'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

writeStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
writeStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
writeStream<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="相对底层的接口"><a href="#相对底层的接口" class="header-anchor">#</a> 相对底层的接口</h3> <blockquote><p>fs.write(fd, buffer, offset, length[, position], callback)
fs.write(fd, data[, position[, encoding]], callback)
fs.writeSync(fd, buffer, offset, length[, position])
fs.writeSync(fd, data[, position[, encoding]])</p></blockquote> <ul><li>fd：写入的文件句柄。</li> <li>buffer：写入的内容。</li> <li>offset：将buffer从offset位置开始，长度为length的内容写入。</li> <li>length：写入的buffer内容的长度。</li> <li>position：从打开文件的position处写入。</li> <li>callback：参数为 <code>(err, written, buffer)</code>。<code>written</code>表示有xx字节的buffer被写入。</li></ul> <p>备注：<code>fs.write(fd, buffer, offset, length[, position], callback)</code>跟<code>fs.write(fd, data[, position[, encoding]], callback)</code>的区别在于：后面的只能把所有的data写入，而前面的可以写入指定的data子串？</p> <h2 id="文件是否存在"><a href="#文件是否存在" class="header-anchor">#</a> 文件是否存在</h2> <p><code>fs.exists()</code>已经是<code>deprecated</code>状态，现在可以通过下面代码判断文件是否存在。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">'./fileForRead.txt'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fileForRead.txt存在'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">'./fileForRead2.txt'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fileForRead2.txt存在'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>fs.access()</code>除了判断文件是否存在（默认模式），还可以用来判断文件的权限。</p> <p>备忘：<code>fs.constants.F_OK</code>等常量无法获取（node v6.1，mac 10.11.4下，<code>fs.constants</code>是<code>undefined</code>）</p> <h2 id="创建目录"><a href="#创建目录" class="header-anchor">#</a> 创建目录</h2> <p>异步版本（如果目录已存在，会报错）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string">'./hello'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'目录创建成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>同步版本</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span><span class="token string">'./hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="删除文件"><a href="#删除文件" class="header-anchor">#</a> 删除文件</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">'./fileForUnlink.txt'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件删除成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span><span class="token string">'./fileForUnlink.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="创建目录-2"><a href="#创建目录-2" class="header-anchor">#</a> 创建目录</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// fs.mkdir(path[, mode], callback)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string">'sub'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'创建目录成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// fs.mkdirSync(path[, mode])</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span><span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'创建目录成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="遍历目录"><a href="#遍历目录" class="header-anchor">#</a> 遍历目录</h2> <p>同步版本，注意：<code>fs.readdirSync()</code>只会读一层，所以需要判断文件类型是否目录，如果是，则进行递归遍历。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// fs.readdirSync(path[, options])</span>

<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">getFilesInDir</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">var</span> results <span class="token operator">=</span> <span class="token punctuation">[</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        file <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">var</span> stats <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            results <span class="token operator">=</span> results<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span> <span class="token function">getFilesInDir</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> results<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> files <span class="token operator">=</span> <span class="token function">getFilesInDir</span><span class="token punctuation">(</span><span class="token string">'../'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>异步版本：（TODO）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
</code></pre></div><h2 id="文件重命名"><a href="#文件重命名" class="header-anchor">#</a> 文件重命名</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// fs.rename(oldPath, newPath, callback)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">'./hello'</span><span class="token punctuation">,</span> <span class="token string">'./world'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'重命名成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">renameSync</span><span class="token punctuation">(</span>oldPath<span class="token punctuation">,</span> newPath<span class="token punctuation">)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">renameSync</span><span class="token punctuation">(</span><span class="token string">'./world'</span><span class="token punctuation">,</span> <span class="token string">'./hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="监听文件修改"><a href="#监听文件修改" class="header-anchor">#</a> 监听文件修改</h2> <p><code>fs.watch()</code>比<code>fs.watchFile()</code>高效很多（why）</p> <h3 id="fs-watchfile"><a href="#fs-watchfile" class="header-anchor">#</a> fs.watchFile()</h3> <p>实现原理：轮询。每隔一段时间检查文件是否发生变化。所以在不同平台上表现基本是一致的。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    persistent<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 默认就是true</span>
    interval<span class="token operator">:</span> <span class="token number">2000</span>  <span class="token comment">// 多久检查一次</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// curr, prev 是被监听文件的状态, fs.Stat实例</span>
<span class="token comment">// 可以通过 fs.unwatch() 移除监听</span>
fs<span class="token punctuation">.</span><span class="token function">watchFile</span><span class="token punctuation">(</span><span class="token string">'./fileForWatch.txt'</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">curr<span class="token punctuation">,</span> prev</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改时间为: '</span> <span class="token operator">+</span> curr<span class="token punctuation">.</span>mtime<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>修改<code>fileForWatch.txt</code>，可以看到控制台下打印出日志</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>node watchFile<span class="token punctuation">.</span>js
修改时间为: Sat Jul 16 2016 19:03:57 GMT<span class="token operator">+</span>0800 <span class="token punctuation">(</span>CST<span class="token punctuation">)</span>
修改时间为: Sat Jul 16 2016 19:04:05 GMT<span class="token operator">+</span>0800 <span class="token punctuation">(</span>CST<span class="token punctuation">)</span>
</code></pre></div><p>为啥子？莫非单纯访问文件也会触发回调？</p> <blockquote><p>If you want to be notified when the file was modified, not just accessed, you need to compare curr.mtime and prev.mtime.</p></blockquote> <p>在 <strong>v0.10</strong> 之后的改动。如果监听的文件不存在，会怎么处理。如下</p> <blockquote><p>Note: when an fs.watchFile operation results in an ENOENT error, it will invoke the listener once, with all the fields zeroed (or, for dates, the Unix Epoch). In Windows, blksize and blocks fields will be undefined, instead of zero. If the file is created later on, the listener will be called again, with the latest stat objects. This is a change in functionality since v0.10.</p></blockquote> <h3 id="fs-watch"><a href="#fs-watch" class="header-anchor">#</a> fs.watch()</h3> <blockquote><p>fs.watch(filename[, options][, listener])
fs.unwatchFile(filename[, listener])</p></blockquote> <p>这接口非常不靠谱（当前测试用的v6.1.0），参考 https://github.com/nodejs/node/issues/7420</p> <blockquote><p>fs.watch(filename[, options][, listener])#</p></blockquote> <p>注意：<code>fs.watch()</code>这个接口并不是在所有的平台行为都一致，并且在某些情况下是不可用的。<code>recursive</code>这个选项只在<code>mac</code>、<code>windows</code>下可用。</p> <p>问题来了：</p> <ol><li>不一致的表现。</li> <li>不可用的场景。</li> <li>linux上要recursive咋整。</li></ol> <blockquote><p>The fs.watch API is not 100% consistent across platforms, and is unavailable in some situations.
The recursive option is only supported on OS X and Windows.</p></blockquote> <p>备忘，不可用的场景。比如网络文件系统等。</p> <blockquote><p>For example, watching files or directories can be unreliable, and in some cases impossible, on network file systems (NFS, SMB, etc), or host file systems when using virtualization software such as Vagrant, Docker, etc.</p></blockquote> <p>另外，listener回调有两个参数，分别是<code>event</code>、<code>filename</code>。其中，<code>filename</code>仅在linux、windows上会提供，并且不是100%提供，所以，尽量不要依赖<code>filename</code>。</p> <p>在linux、osx上，<code>fs.watch()</code>监听的是inode。如果文件被删除，并重新创建，那么删除事件会触发。同时，<code>fs.watch()</code>监听的还是最初的inode。（API的设计就是这样的）</p> <p>结论：怎么看都感觉这个API很不靠谱，虽然性能比fs.watchFile()要高很多。</p> <p>先来个例子，在osx下测试了一下，简直令人绝望。。。无论是创建、修改、删除文件，<code>evt</code>都是<code>rename</code>。。。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    persistent<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    recursive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    encoding<span class="token operator">:</span> <span class="token string">'utf8'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'../'</span><span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'触发事件:'</span> <span class="token operator">+</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件名是: '</span> <span class="token operator">+</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件名是没有提供'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>修改下<code>fileForWatch.txt</code>，看到下面输出。。。感觉打死也不想用这个API。。。</p> <p>贴下环境：osx 10.11.4, node v6.1.0。</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>触发事件:rename
文件名是: fs<span class="token operator">/</span>fileForWatch<span class="token punctuation">.</span>txt___jb_bak___
触发事件:rename
文件名是: fs<span class="token operator">/</span>fileForWatch<span class="token punctuation">.</span>txt
触发事件:rename
文件名是: fs<span class="token operator">/</span>fileForWatch<span class="token punctuation">.</span>txt___jb_old___
触发事件:rename
文件名是: <span class="token punctuation">.</span>idea<span class="token operator">/</span>workspace<span class="token punctuation">.</span>xml___jb_bak___
触发事件:rename
文件名是: <span class="token punctuation">.</span>idea<span class="token operator">/</span>workspace<span class="token punctuation">.</span>xml
触发事件:rename
文件名是: <span class="token punctuation">.</span>idea<span class="token operator">/</span>workspace<span class="token punctuation">.</span>xml___jb_old___
</code></pre></div><h2 id="修改所有者"><a href="#修改所有者" class="header-anchor">#</a> 修改所有者</h2> <p>参考linux命令行，不举例子了。。。</p> <blockquote><p>fs.chown(path, uid, gid, callback)
fs.chownSync(path, uid, gid)
fs.fchown(fd, uid, gid, callback)
fs.fchownSync(fd, uid, gid)</p></blockquote> <h2 id="修改权限"><a href="#修改权限" class="header-anchor">#</a> 修改权限</h2> <p>可以用<code>fs.chmod()</code>，也可以用<code>fs.fchmod()</code>。两者的区别在于，前面传的是文件路径，后面传的的文件句柄。</p> <ol><li><code>fs.chmod)</code>、<code>fs.fchmod()</code>区别：传的是文件路径，还是文件句柄。</li> <li><code>fs.chmod()</code>、<code>fs.lchmod()</code>区别：如果文件是软连接，那么<code>fs.chmod()</code>修改的是软连接指向的目标文件；<code>fs.lchmod()</code>修改的是软连接。</li></ol> <blockquote><p>fs.chmod(path, mode, callback)
fs.chmodSync(path, mode)</p></blockquote> <blockquote><p>fs.fchmod(fd, mode, callback)
fs.fchmodSync(fd, mode)</p></blockquote> <blockquote><p>fs.lchmod(path, mode, callback)#
fs.lchmodSync(path, mode)</p></blockquote> <p>例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">chmod</span><span class="token punctuation">(</span><span class="token string">'./fileForChown.txt'</span><span class="token punctuation">,</span> <span class="token string">'777'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'权限修改成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>同步版本：</p> <div class="language- extra-class"><pre class="language-text"><code>var fs = require('fs');

fs.chmodSync('./fileForChown.txt', '777');
</code></pre></div><h2 id="获取文件状态"><a href="#获取文件状态" class="header-anchor">#</a> 获取文件状态</h2> <p>区别：</p> <ul><li><code>fs.stat()</code> vs <code>fs.fstat()</code>：传文件路径 vs 文件句柄。</li> <li><code>fs.stat()</code> vs <code>fs.lstat()</code>：如果文件是软链接，那么<code>fs.stat()</code>返回目标文件的状态，<code>fs.lstat()</code>返回软链接本身的状态。</li></ul> <blockquote><p>fs.stat(path, callback)
fs.statSync(path)</p></blockquote> <blockquote><p>fs.fstat(fd, callback)
fs.fstatSync(fd)</p></blockquote> <blockquote><p>fs.lstat(path, callback)
fs.lstatSync(path)</p></blockquote> <p>主要关注<code>Class: fs.Stats</code>。</p> <p>首先是方法</p> <ul><li>stats.isFile()  -- 是否文件</li> <li>stats.isDirectory() -- 是否目录</li> <li>stats.isBlockDevice() -- 什么鬼</li> <li>stats.isCharacterDevice() -- 什么鬼</li> <li>stats.isSymbolicLink() (only valid with fs.lstat()) -- 什么鬼</li> <li>stats.isFIFO() -- 什么鬼</li> <li>stats.isSocket() -- 是不是socket文件</li></ul> <p>官网例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  dev<span class="token operator">:</span> <span class="token number">2114</span><span class="token punctuation">,</span>
  ino<span class="token operator">:</span> <span class="token number">48064969</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token number">33188</span><span class="token punctuation">,</span>
  nlink<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  uid<span class="token operator">:</span> <span class="token number">85</span><span class="token punctuation">,</span>
  gid<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  rdev<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  size<span class="token operator">:</span> <span class="token number">527</span><span class="token punctuation">,</span>
  blksize<span class="token operator">:</span> <span class="token number">4096</span><span class="token punctuation">,</span>
  blocks<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
  atime<span class="token operator">:</span> Mon<span class="token punctuation">,</span> <span class="token number">10</span> Oct <span class="token number">2011</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">11</span> <span class="token constant">GMT</span><span class="token punctuation">,</span> <span class="token comment">// 访问时间</span>
  mtime<span class="token operator">:</span> Mon<span class="token punctuation">,</span> <span class="token number">10</span> Oct <span class="token number">2011</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">11</span> <span class="token constant">GMT</span><span class="token punctuation">,</span>  <span class="token comment">// 文件内容修改时间</span>
  ctime<span class="token operator">:</span> Mon<span class="token punctuation">,</span> <span class="token number">10</span> Oct <span class="token number">2011</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">11</span> <span class="token constant">GMT</span><span class="token punctuation">,</span>  <span class="token comment">// 文件状态修改时间</span>
  birthtime<span class="token operator">:</span> Mon<span class="token punctuation">,</span> <span class="token number">10</span> Oct <span class="token number">2011</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">24</span><span class="token operator">:</span><span class="token number">11</span> <span class="token constant">GMT</span>  <span class="token comment">// 创建时间</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>atime：Access Time // 访问时间</li> <li>mtime:: Modified Time  // 文件内容修改时间</li> <li>ctime: Changed Time.  // 文件状态修改时间，比如修改文件所有者、修改权限、重命名等</li> <li>birthtime: Birth Time // 创建时间。在某些系统上是不可靠的，因为拿不到。</li></ul> <p>例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">getTimeDesc</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>d<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token punctuation">[</span>d<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span><span class="token string">'./fileForStat.txt'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件大小: '</span> <span class="token operator">+</span> stats<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'创建时间: '</span> <span class="token operator">+</span> <span class="token function">getTimeDesc</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span>birthtime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'访问时间: '</span> <span class="token operator">+</span> <span class="token function">getTimeDesc</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span>atime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改时间: '</span> <span class="token operator">+</span> <span class="token function">getTimeDesc</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span>mtime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出如下：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>node stat<span class="token punctuation">.</span>js
文件大小: 3613
创建时间: 2016<span class="token operator">-</span>7<span class="token operator">-</span>16 12:40:49
访问时间: 2016<span class="token operator">-</span>7<span class="token operator">-</span>16 12:40:49
修改时间: 2016<span class="token operator">-</span>7<span class="token operator">-</span>16 12:40:49

<span class="token keyword">Process</span> finished with <span class="token keyword">exit</span> code 0
</code></pre></div><p>同步的例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">getTimeDesc</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>d<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token punctuation">[</span>d<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> stats <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span><span class="token string">'./fileForStat.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件大小: '</span> <span class="token operator">+</span> stats<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'创建时间: '</span> <span class="token operator">+</span> <span class="token function">getTimeDesc</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span>birthtime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'访问时间: '</span> <span class="token operator">+</span> <span class="token function">getTimeDesc</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span>atime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改时间: '</span> <span class="token operator">+</span> <span class="token function">getTimeDesc</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span>mtime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="访问-权限检测"><a href="#访问-权限检测" class="header-anchor">#</a> 访问/权限检测</h2> <p>例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// fs.access(path[, mode], callback)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">'./fileForAccess.txt'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'可以访问'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>同步版本：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// fs.accessSync(path[, mode])</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 如果成功，则返回undefined，如果失败，则抛出错误（什么鬼）</span>
<span class="token keyword">try</span><span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">accessSync</span><span class="token punctuation">(</span><span class="token string">'./fileForAccess.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">throw</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="文件打开-关闭"><a href="#文件打开-关闭" class="header-anchor">#</a> 文件打开/关闭</h2> <p>比较底层的接口，实际需要用到的机会不多。需要用到的时候看下<a href="https://nodejs.org/api/fs.html#fs_fs_open_path_flags_mode_callback" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>就行。</p> <ul><li>flags：文件打开模式，比如<code>r</code>、<code>r+</code>、<code>w</code>、<code>w+</code>等。可选模式非常多。</li> <li>mode：默认是<code>666</code>，可读+可写。</li></ul> <blockquote><p>fs.open(path, flags[, mode], callback)
fs.openSync(path, flags[, mode])
fs.close(fd, callback)
fs.closeSync(fd)</p></blockquote> <h2 id="文件读取-底层"><a href="#文件读取-底层" class="header-anchor">#</a> 文件读取（底层）</h2> <p>相对底层的读取接口，参数如下</p> <ul><li>fd：文件句柄。</li> <li>buffer：将读取的文件内容写到buffer里。</li> <li>offset：buffer开始写入的位置。（在offset开始写入，还是offset+1？）</li> <li>length：要读取的字节数。</li> <li>position：文件从哪个位置开始读取。如果是null，那么就从当前位置开始读取。（读取操作会记录下上一个位置）</li></ul> <p>此外，<code>callback</code>的回调参数为<code>(err, bytesRead, buffer)</code></p> <blockquote><p>fs.read(fd, buffer, offset, length, position, callback)</p></blockquote> <h2 id="追加文件内容"><a href="#追加文件内容" class="header-anchor">#</a> 追加文件内容</h2> <blockquote><p>fs.appendFile(file, data[, options], callback)</p></blockquote> <ul><li>file：可以是文件路径，也可以是文件句柄。（还可以是buffer？）</li> <li>data：要追加的内容。string或者buffer。</li> <li>options
<ul><li>encoding：编码，默认是<code>utf8</code></li> <li>mode：默认是<code>0o666</code></li> <li>flag：默认是<code>a</code></li></ul></li></ul> <p>注意：如果<code>file</code>是文件句柄，那么</p> <ul><li>开始追加数据前，file需要已经打开。</li> <li>file需要手动关闭。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span><span class="token string">'./extra/fileForAppend.txt'</span><span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'append成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="文件内容截取"><a href="#文件内容截取" class="header-anchor">#</a> 文件内容截取</h2> <blockquote><p>fs.truncate(path, len, callback)
fs.truncateSync(path, len)</p> <p>fs.ftruncate(fd, len, callback)
fs.ftruncateSync(fd, len)</p></blockquote> <p>用途参考<a href="http://man7.org/linux/man-pages/man2/ftruncate.2.html" target="_blank" rel="noopener noreferrer">linux说明文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>要点：</p> <ul><li><code>offset</code>不会变化。比如通过<code>fs.read()</code>读取文件内容，就需要特别注意。</li> <li>如果<code>len</code>小于文件内容长度，剩余文件内容部分会丢失；如果<code>len</code>大于文件内容长度，那么超出的部分，会用<code>\0</code>进行填充。</li> <li>如果传的是文件路径，需要确保文件是可写的；如果传的是文件句柄，需要确保文件句柄已经打开并且可写入。</li></ul> <blockquote><p>The truncate() and ftruncate() functions cause the regular file named
by path or referenced by fd to be truncated to a size of precisely
length bytes.</p></blockquote> <blockquote><p>If the file previously was larger than this size, the extra data is
lost.  If the file previously was shorter, it is extended, and the
extended part reads as null bytes ('\0').</p></blockquote> <blockquote><p>The file offset is not changed.</p></blockquote> <blockquote><p>With ftruncate(), the file must be open for writing; with truncate(), the file must be writable.</p></blockquote> <h2 id="修改文件属性-时间"><a href="#修改文件属性-时间" class="header-anchor">#</a> 修改文件属性（时间）</h2> <ul><li>path/fd：文件路径/文件句柄</li> <li>atime：Access Time。上一次访问文件数据的时间。</li> <li>mtime：Modified Time。修改时间。</li></ul> <blockquote><p>fs.utimes(path, atime, mtime, callback)
fs.utimesSync(path, atime, mtime)</p></blockquote> <blockquote><p>fs.futimes(fd, atime, mtime, callback)
fs.futimesSync(fd, atime, mtime)</p></blockquote> <p>备注，在命令行下可以</p> <ul><li>通过<code>stat</code>查看文件的状态信息，包括了上面的atime、mtime。</li> <li>通过<code>touch</code>修改这几个时间。</li></ul> <h2 id="创建文件链接"><a href="#创建文件链接" class="header-anchor">#</a> 创建文件链接</h2> <blockquote><p>fs.symlink(target, path[, type], callback)
fs.symlinkSync(target, path[, type])</p> <p>fs.link(srcpath, dstpath, callback)
fs.linkSync(srcpath, dstpath)</p></blockquote> <blockquote><p>link() creates a new link (also known as a hard link) to an existing file.</p></blockquote> <p>软链接、硬链接区别：<a href="https://www.ibm.com/developerworks/cn/linux/l-cn-hardandsymb-links/" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或者 [这个]。(http://www.cnblogs.com/itech/archive/2009/04/10/1433052.html)</p> <ul><li>硬链接：inode相同，多个别名。删除一个硬链接文件，不会影响其他有相同inode的文件。</li> <li>软链接：有自己的inode，用户数据块存放指向文件的inode。</li></ul> <p>参考<a href="http://man7.org/linux/man-pages/man2/link.2.html" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="创建临时目录"><a href="#创建临时目录" class="header-anchor">#</a> 创建临时目录</h2> <blockquote><p>fs.mkdtemp(prefix, callback)
fs.mkdtempSync(prefix)</p></blockquote> <p>备忘：跟普通的随便找个目录，创建个随机名字的文件夹，有什么区别？</p> <p>代码示例如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">mkdtemp</span><span class="token punctuation">(</span><span class="token string">'/tmp/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> folder</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'创建临时目录: '</span> <span class="token operator">+</span> folder<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出如下：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>node mkdtemp<span class="token punctuation">.</span>js
创建临时目录: <span class="token operator">/</span>tmp<span class="token operator">/</span>Cxw51O
</code></pre></div><h2 id="找出软连接指向的真实路径"><a href="#找出软连接指向的真实路径" class="header-anchor">#</a> 找出软连接指向的真实路径</h2> <blockquote><p>fs.readlink(path[, options], callback)
fs.readlinkSync(path[, options])</p></blockquote> <p>如下面例子，创建了个软链接指向<code>fileForReadLink.txt</code>，通过<code>fs.readlink()</code>就可以找出原始的路径。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> randomFileName <span class="token operator">=</span> <span class="token string">'./extra/fileForReadLink-'</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.txt'</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">symlinkSync</span><span class="token punctuation">(</span><span class="token string">'./extra/fileForReadLink.txt'</span><span class="token punctuation">,</span> randomFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readlink</span><span class="token punctuation">(</span>randomFileName<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> linkString</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'链接文件内容: '</span> <span class="token operator">+</span> linkString<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>类似终端下直接运行<code>readlink</code>。对于软链接文件，效果同上面代码。对于硬链接，没有输出。</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>➜  extra git:<span class="token punctuation">(</span>master<span class="token punctuation">)</span> ✗ readlink fileForReadLink<span class="token operator">-</span>9827<span class="token punctuation">.</span>txt
<span class="token punctuation">.</span><span class="token operator">/</span>extra<span class="token operator">/</span>fileForReadLink<span class="token punctuation">.</span>txt
➜  extra git:<span class="token punctuation">(</span>master<span class="token punctuation">)</span> ✗ readlink fileForLinkHard<span class="token punctuation">.</span>txt 
➜  extra git:<span class="token punctuation">(</span>master<span class="token punctuation">)</span> ✗ readlink fileForLinkSoft<span class="token punctuation">.</span>txt
<span class="token punctuation">.</span><span class="token operator">/</span>extra<span class="token operator">/</span>fileForLink<span class="token punctuation">.</span>txt
</code></pre></div><h2 id="真实路径"><a href="#真实路径" class="header-anchor">#</a> 真实路径</h2> <blockquote><p>fs.realpath(path[, options], callback)
fs.realpathSync(path[, options])</p></blockquote> <p>例子：（不能作用于软链接？）</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fileForRealPath1.txt 是普通文件,正常运行</span>
fs<span class="token punctuation">.</span><span class="token function">realpath</span><span class="token punctuation">(</span><span class="token string">'./extra/inner/fileForRealPath1.txt'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> resolvedPath</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fs.realpath: '</span> <span class="token operator">+</span> resolvedPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fileForRealPath.txt 是软链接, 会报错,提示找不到文件</span>
fs<span class="token punctuation">.</span><span class="token function">realpath</span><span class="token punctuation">(</span><span class="token string">'./extra/inner/fileForRealPath.txt'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> resolvedPath</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fs.realpath: '</span> <span class="token operator">+</span> resolvedPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">'path.resolve: '</span> <span class="token operator">+</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./extra/inner/fileForRealpath.txt'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出如下：</p> <div class="language-powershell extra-class"><pre class="language-powershell"><code>path<span class="token punctuation">.</span>resolve: <span class="token operator">/</span>Users<span class="token operator">/</span>a<span class="token operator">/</span>Documents<span class="token operator">/</span>git<span class="token operator">-</span>code<span class="token operator">/</span>git<span class="token operator">-</span>blog<span class="token operator">/</span>demo<span class="token operator">/</span>2015<span class="token punctuation">.</span>05<span class="token punctuation">.</span>21<span class="token operator">-</span>node<span class="token operator">-</span>basic<span class="token operator">/</span>fs<span class="token operator">/</span>extra<span class="token operator">/</span>inner<span class="token operator">/</span>fileForRealpath<span class="token punctuation">.</span>txt
fs<span class="token punctuation">.</span>realpath: <span class="token operator">/</span>Users<span class="token operator">/</span>a<span class="token operator">/</span>Documents<span class="token operator">/</span>git<span class="token operator">-</span>code<span class="token operator">/</span>git<span class="token operator">-</span>blog<span class="token operator">/</span>demo<span class="token operator">/</span>2015<span class="token punctuation">.</span>05<span class="token punctuation">.</span>21<span class="token operator">-</span>node<span class="token operator">-</span>basic<span class="token operator">/</span>fs<span class="token operator">/</span>extra<span class="token operator">/</span>inner<span class="token operator">/</span>fileForRealPath1<span class="token punctuation">.</span>txt
<span class="token operator">/</span>Users<span class="token operator">/</span>a<span class="token operator">/</span>Documents<span class="token operator">/</span>git<span class="token operator">-</span>code<span class="token operator">/</span>git<span class="token operator">-</span>blog<span class="token operator">/</span>demo<span class="token operator">/</span>2015<span class="token punctuation">.</span>05<span class="token punctuation">.</span>21<span class="token operator">-</span>node<span class="token operator">-</span>basic<span class="token operator">/</span>fs<span class="token operator">/</span>realpath<span class="token punctuation">.</span>js:12
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
            ^

Error: ENOENT: no such file or directory<span class="token punctuation">,</span> realpath <span class="token string">'./extra/inner/fileForRealPath.txt'</span>
    at Error <span class="token punctuation">(</span>native<span class="token punctuation">)</span>

<span class="token keyword">Process</span> finished with <span class="token keyword">exit</span> code 1
</code></pre></div><h2 id="删除目录"><a href="#删除目录" class="header-anchor">#</a> 删除目录</h2> <blockquote><p>fs.rmdir(path, callback)
fs.rmdirSync(path)</p></blockquote> <p>例子如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token string">'./dirForRemove'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'目录删除成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="不常用"><a href="#不常用" class="header-anchor">#</a> 不常用</h2> <h3 id="缓冲区内容写到磁盘"><a href="#缓冲区内容写到磁盘" class="header-anchor">#</a> 缓冲区内容写到磁盘</h3> <blockquote><p>fs.fdatasync(fd, callback)
fs.fdatasyncSync(fd)</p></blockquote> <p>可以参考这里：</p> <blockquote><p>1、sync函数
sync函数只是将所有修改过的块缓冲区排入写队列，然后就返回，它并不等待实际写磁盘操作结束。
通常称为update的系统守护进程会周期性地（一般每隔30秒）调用sync函数。这就保证了定期冲洗内核的块缓冲区。命令sync(1)也调用sync函数。
2、fsync函数
fsync函数只对由文件描述符filedes指定的单一文件起作用，并且等待写磁盘操作结束，然后返回。
fsync可用于数据库这样的应用程序，这种应用程序需要确保将修改过的块立即写到磁盘上。
3、fdatasync函数
fdatasync函数类似于fsync，但它只影响文件的数据部分。而除数据外，fsync还会同步更新文件的属性。
对于提供事务支持的数据库，在事务提交时，都要确保事务日志（包含该事务所有的修改操作以及一个提交记录）完全写到硬盘上，才认定事务提交成功并返回给应用层。</p></blockquote> <h2 id="待确认"><a href="#待确认" class="header-anchor">#</a> 待确认</h2> <ol><li>通篇的<code>mode</code>，待确认。</li> <li>fs.access()更多用法（涉及 fs.constants.F_OK等权限）</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/node/modules/-1.0 本地路径处理 path.html" class="prev">
        1.0 本地路径处理 path
      </a></span> <span class="next"><a href="/blog/node/modules/-3.1 基础调试 console.html">
        3.1 基础调试 console
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.a9945600.js" defer></script><script src="/blog/assets/js/2.3af135cd.js" defer></script><script src="/blog/assets/js/92.63c5ea3b.js" defer></script>
  </body>
</html>
